name: CI
'on':
  push:
    branches:
      - master
  workflow_dispatch:
jobs:
  build-dita:
    name: Build DITA
    runs-on: ubuntu-latest
    steps:
      - name: Git checkout
        uses: actions/checkout@v2

      - name: Build Bootstrap ‚öôÔ∏è
        uses: dita-ot/dita-ot-action@4.3
        with:
          install: |
            apt-get update -q
            export DEBIAN_FRONTEND=noninteractive
            apt-get install -qy --no-install-recommends nodejs
            nodejs -v
          plugins: |
            fox.jason.extend.css
            net.infotexture.dita-bootstrap
            net.infotexture.dita-bootstrap.lunr
            fox.jason.prismjs
            fox.jason.favicon
            fox.jason.open-graph
          project: .github/dita-ot/html.xml
          # If you have a DITAVal, add the following:
          # -- build: | 
          #     dita -i dita/document.ditamap -o out/html -f html5 --filter=myfilter.ditaval

      - name: Deploy HTML üöÄ
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages # The branch the action should deploy to.
          FOLDER: out/html  # The folder the action should deploy.

      - name: Build PDF üñ®Ô∏è
        uses: dita-ot/dita-ot-action@4.3
        with:
          install: |
            apt-get update -q
            export DEBIAN_FRONTEND=noninteractive
            apt-get install -qy --no-install-recommends nodejs
            nodejs -v
          plugins: |
            fox.jason.extend.css
            fox.jason.prismjs
          build: |
            dita -i dita/document.ditamap -o out/pdf -f pdf --theme=.github/themes/theme.yaml --org.dita.index.skip="yes"
          # If you have a DITAVal, replace the previous line with the following:
          # build: |
          #   dita -i dita/document.ditamap -o out/pdf -f pdf --theme=.github/themes/theme.yaml --org.dita.index.skip="yes" --filter=myfilter.ditaval

      - name: Upload PDF üìö
        uses: actions/upload-artifact@v4
        with:
          name: dita-pdf
          path: 'out/pdf'

      # ---------------------------
      # EPUB build & upload section
      # ---------------------------
      - name: Build EPUB üìñ
        uses: dita-ot/dita-ot-action@4.3
        with:
          install: |
            apt-get update -q
            export DEBIAN_FRONTEND=noninteractive
            apt-get install -qy --no-install-recommends nodejs
            nodejs -v
          plugins: |
            org.dita4publishers.epub
          # If registry install fails, comment the line above and use a direct ZIP URL:
          # install: |
          #   dita --install https://github.com/dita4publishers/dita4publishers/releases/download/1.0.0RC28/org.dita4publishers.epub.zip
          build: |
            dita -i dita/document.ditamap -o out/epub -f epub
          # With DITAVal:
          # build: |
          #   dita -i dita/document.ditamap -o out/epub -f epub --filter=myfilter.ditaval
          # Add custom CSS (adjust paths as needed):
          #   -Dargs.cssroot=.github/themes -Dargs.css=epub.css

      - name: Upload EPUB üìó
        uses: actions/upload-artifact@v4
        with:
          name: dita-epub
          path: 'out/epub/*.epub'
